=== FTS Export Test Script ===
Output will be logged to: /home/burner/Desktop/ArxLibertatis/fts_test_output.log
Step 1: Restoring original FTS file from backup...
  Restored: /home/burner/Desktop/ArxLibertatis/build/game/graph/levels/level1/fast.fts
Step 2: Running Blender with UI...
  Executing Blender with UI automation...
DEBUG:ArxAddon:register
INFO:ArxAddon:creating
INFO:ArxAddon:invalidating
INFO:ArxAddon:creating
INFO:ArxSceneManager:Importing Area: 1
DEBUG:DlfSerializer:Loaded 23597 bytes from file /home/burner/Desktop/ArxLibertatis/build/graph/levels/level1/level1.dlf
DEBUG:DlfSerializer:DANAE_LS_HEADER version: 1.440000
DEBUG:DlfSerializer:DANAE_LS_SCENE name: Graph\Levels\Level1\
DEBUG:FtsSerializer:Loaded 5336967 bytes from file /home/burner/Desktop/ArxLibertatis/build/game/graph/levels/level1/fast.fts
DEBUG:FtsSerializer:Header path: C:\ARX\Game\Graph\Levels\Level1\
DEBUG:FtsSerializer:Header count: 2
DEBUG:FtsSerializer:Header version: 0.141000
DEBUG:FtsSerializer:Header uncompressedsize: 11180884
DEBUG:FtsSerializer:Header2 path: Anchor1.scn
DEBUG:FtsSerializer:Header2 path: Level_1_portalized.scn
DEBUG:FtsSerializer:About to unpack from position 1816 (0x718), remaining data: 5335151 bytes
DEBUG:FtsSerializer:Fts Header version: 0.141000
DEBUG:FtsSerializer:Fts Header size x,z: 160,160
DEBUG:FtsSerializer:Fts Header playerpos: 8650.000000,3105.079102,8550.000000
DEBUG:FtsSerializer:Fts Header Mscenepos: 16250.000000,3105.079102,5550.000000
DEBUG:FtsSerializer:Fts Header nb_rooms: 52
DEBUG:FtsSerializer:Loaded 206 textures
DEBUG:FtsSerializer:Loaded 11180884 bytes of 11180884
INFO:FtsSerializer:Stored original header: uncompressed=11180884, nb_rooms=52
INFO:LlfSerializer:Loaded 437501 bytes from file /home/burner/Desktop/ArxLibertatis/build/graph/levels/level1/level1.llf
DEBUG:FtsSerializer:Loaded 5336967 bytes from file /home/burner/Desktop/ArxLibertatis/build/game/graph/levels/level1/fast.fts
DEBUG:FtsSerializer:Header path: C:\ARX\Game\Graph\Levels\Level1\
DEBUG:FtsSerializer:Header count: 2
DEBUG:FtsSerializer:Header version: 0.141000
DEBUG:FtsSerializer:Header uncompressedsize: 11180884
DEBUG:FtsSerializer:Header2 path: Anchor1.scn
DEBUG:FtsSerializer:Header2 path: Level_1_portalized.scn
DEBUG:FtsSerializer:About to unpack from position 1816 (0x718), remaining data: 5335151 bytes
DEBUG:FtsSerializer:Fts Header version: 0.141000
DEBUG:FtsSerializer:Fts Header size x,z: 160,160
DEBUG:FtsSerializer:Fts Header playerpos: 8650.000000,3105.079102,8550.000000
DEBUG:FtsSerializer:Fts Header Mscenepos: 16250.000000,3105.079102,5550.000000
DEBUG:FtsSerializer:Fts Header nb_rooms: 52
DEBUG:FtsSerializer:Loaded 206 textures
DEBUG:FtsSerializer:Loaded 11180884 bytes of 11180884
INFO:FtsSerializer:Stored original header: uncompressed=11180884, nb_rooms=52
INFO:FtsSerializer:Writing FTS file: /home/burner/Desktop/ArxLibertatis/build/game/graph/levels/level1/fast.fts
INFO:FtsSerializer:Generated FTS binary data: 11180884 bytes
INFO:FtsSerializer:Size difference from original: 0 bytes (generated: 11180884, expected: 11180884)
INFO:FtsSerializer:PKWare compressed data: 12578499 bytes
WARNING:FtsSerializer:Headers truncated from 1040 to 1040 bytes
INFO:FtsSerializer:Header claims uncompressed size: 11180884
INFO:FtsSerializer:Exported PKWare compressed FTS: 11180884 → 12578499 bytes
DEBUG:ArxAddon:unregister
INFO:ArxAddon:invalidating
register_class(...):
Warning: 'ArxFacePanel' does not contain '_PT_' with prefix and suffix
=== Blender Automation Script ===
Opening blend file: /home/burner/Desktop/ArxLibertatis/plugins/blender/arx_addon/all models load.blend
Registering timer to wait for context...
Found valid window and 3D Viewport context
Waiting for UI to stabilize...
Accessing Arx addon...
Configuring Arx addon preferences...
Set arxAssetPath to: /home/burner/Desktop/ArxLibertatis/build
Checking if Arx operators are registered...
Available operators: ['arx']
Manually reloading area list...
Loaded 24 areas
  Area 0: Area 0 (ID: 0)
  Area 1: Area 1 (ID: 1)
  Area 2: Area 2 (ID: 2)
  Area 3: Area 3 (ID: 3)
  Area 4: Area 4 (ID: 4)
  Area 5: Area 5 (ID: 5)
  Area 6: Area 6 (ID: 6)
  Area 7: Area 7 (ID: 7)
  Area 8: Area 8 (ID: 8)
  Area 9: Area 10 (ID: 10)
  Area 10: Area 11 (ID: 11)
  Area 11: Area 12 (ID: 12)
  Area 12: Area 13 (ID: 13)
  Area 13: Area 14 (ID: 14)
  Area 14: Area 15 (ID: 15)
  Area 15: Area 16 (ID: 16)
  Area 16: Area 17 (ID: 17)
  Area 17: Area 18 (ID: 18)
  Area 18: Area 19 (ID: 19)
  Area 19: Area 20 (ID: 20)
  Area 20: Area 21 (ID: 21)
  Area 21: Area 22 (ID: 22)
  Area 22: Area 23 (ID: 23)
  Area 23: Area 24 (ID: 24)
Manually importing area 1...
REPORT {'INFO'}: Creating new Area Scene [Area_01]
DEBUG: Original face 1: vertex 0 = (6959.6552734375, 3117.577392578125, 4209.95458984375)
DEBUG: Original face 2: vertex 0 = (6959.6552734375, 3117.577392578125, 4209.95458984375)
DEBUG: Import created 58963 faces from FTS, bmesh has 58963 faces
DEBUG: Final Blender mesh has 58963 faces (from 58963 bmesh faces)
DEBUG: Mesh topology - 37713 quads, 21250 triangles
DEBUG: Storing complete original FTS data in scene properties
DEBUG: Stored 206 textures
WARNING: Failed to store FTS data in scene properties: 'str' object cannot be interpreted as an integer
Area 1 import completed
Testing TRUE round-trip editing with Blender export...
Found imported scene: Area_01
Selected area index: 1 (ID: 1)
Executing Blender round-trip export...
DEBUG: Using preserved FTS data from scene properties
DEBUG: Restoring original FTS data from scene properties
DEBUG: Successfully restored FTS data as pure Python structures
DEBUG: Blender face 0: room_id=39
DEBUG: Blender face 1: room_id=39
DEBUG: Blender face 2: room_id=39
DEBUG: Blender face 3: room_id=39
DEBUG: Blender face 4: room_id=39
QUAD/TRIANGLE COUNT: 37713 quads, 21250 triangles, 58963 total faces
DEBUG: Rebuilding room polygon references to fix topology changes
DEBUG: Room 0: 0 polygons
DEBUG: Room 1: 1311 polygons
DEBUG: Room 2: 8086 polygons
DEBUG: Room 3: 6014 polygons
DEBUG: Room 4: 0 polygons
DEBUG: Room 5: 1885 polygons
DEBUG: Room 6: 3919 polygons
DEBUG: Room 7: 1303 polygons
DEBUG: Room 8: 952 polygons
DEBUG: Room 9: 1504 polygons
DEBUG: Room 10: 725 polygons
DEBUG: Room 11: 1021 polygons
DEBUG: Room 12: 882 polygons
DEBUG: Room 13: 1321 polygons
DEBUG: Room 14: 1836 polygons
DEBUG: Room 15: 1125 polygons
DEBUG: Room 16: 0 polygons
DEBUG: Room 17: 1093 polygons
DEBUG: Room 18: 0 polygons
DEBUG: Room 19: 2107 polygons
DEBUG: Room 20: 0 polygons
DEBUG: Room 21: 549 polygons
DEBUG: Room 22: 4592 polygons
DEBUG: Room 23: 0 polygons
DEBUG: Room 24: 0 polygons
DEBUG: Room 25: 0 polygons
DEBUG: Room 26: 550 polygons
DEBUG: Room 27: 319 polygons
DEBUG: Room 28: 369 polygons
DEBUG: Room 29: 852 polygons
DEBUG: Room 30: 533 polygons
DEBUG: Room 31: 407 polygons
DEBUG: Room 32: 685 polygons
DEBUG: Room 33: 346 polygons
DEBUG: Room 34: 460 polygons
DEBUG: Room 35: 93 polygons
DEBUG: Room 36: 0 polygons
DEBUG: Room 37: 0 polygons
DEBUG: Room 38: 0 polygons
DEBUG: Room 39: 808 polygons
DEBUG: Room 40: 1036 polygons
DEBUG: Room 41: 2230 polygons
DEBUG: Room 42: 526 polygons
DEBUG: Room 43: 3469 polygons
DEBUG: Room 44: 1182 polygons
DEBUG: Room 45: 295 polygons
DEBUG: Room 46: 3004 polygons
DEBUG: Room 47: 56 polygons
DEBUG: Room 48: 153 polygons
DEBUG: Room 49: 308 polygons
DEBUG: Room 50: 325 polygons
DEBUG: Room 51: 275 polygons
DEBUG: Room 52: 453 polygons
DEBUG: Rebuilt room references for 53 rooms
DEBUG: Using scene offset: <bpy id property array [3]>
DEBUG: Face 0: room_id=39 → mapped_room=39
DEBUG: FTS polygon 0: 4 vertices, is_quad=True
DEBUG: Face 1: room_id=39 → mapped_room=39
DEBUG: FTS polygon 1: 4 vertices, is_quad=True
DEBUG: Face 2: room_id=39 → mapped_room=39
DEBUG: FTS polygon 2: 4 vertices, is_quad=True
DEBUG: Face 3: room_id=39 → mapped_room=39
DEBUG: FTS polygon 3: 3 vertices, is_quad=False
DEBUG: Face 4: room_id=39 → mapped_room=39
DEBUG: FTS polygon 4: 4 vertices, is_quad=True
DEBUG: Degenerate face 32538: identical vertices detected
DEBUG: Degenerate face 32541: identical vertices detected
DEBUG: Degenerate face 38780: identical vertices detected
DEBUG: Degenerate face 41237: identical vertices detected
DEBUG: Found 4 degenerate faces out of 58963 total
DEBUG: Face 1: preserved cell=(69, 41)
DEBUG: Face 2: preserved cell=(69, 41)
DEBUG: Face 3: preserved cell=(69, 41)
DEBUG: Face 4: preserved cell=(69, 41)
DEBUG: Face 5: preserved cell=(69, 41)
DEBUG: Processed 58963 faces, 58963 placed in original cells, 58963 total in grid
Info: Converted 58963 faces from Blender mesh (37713 quads, 21250 triangles)
Info: Reconstructed cell grid: 58963 polygons in 4967 cells
Info: Successfully wrote FTS file with 58963 faces
Info: Successfully exported Area 1 with 58963 faces
Info: Exported Area 1
SUCCESS: Blender round-trip export completed!
=== Blender operations completed successfully ===
quitting...
Read blend: "/home/burner/Desktop/ArxLibertatis/plugins/blender/arx_addon/all models load.blend"
Saved session recovery to "/tmp/quit.blend"

Blender quit
Step 3: Testing FTS loading with ArxLibertatis...
  Executing: ./arx --loadlevel 01 -g --skiplogo --noclip

[I] Startup:164           Starting Arx Libertatis 1.3-dev + a770014
[I] ArxGame:335           Using config file "/home/burner/.config/arx/cfg.ini"
[I] SDL2Window:191        Using SDL 2.30.0
[I] SDL2Window:541        Window: X11 r:8 g:8 b:8 a:0 depth:24 aa:8x doublebuffer:1
[I] OpenGLRenderer:114    Using OpenGL 4.6 (Compatibility Profile) Mesa 25.1.5 - kisak-mesa PPA
[I] OpenGLRenderer:117     ├─ Vendor: AMD
[I] OpenGLRenderer:120     ├─ Device: AMD Radeon RX 6600 (radeonsi, navi23, LLVM 19.1.7, DRM 3.57, 6.8.0-62-generic)
[I] OpenGLRenderer:129     ├─ Context type: debug
[I] OpenGLRenderer:187     └─ VRAM: 8192 MiB, 7188 MiB free
[I] GLDebug:99            Application info #1: OpenGL debug output enabled
[I] ArxGame:1044          Using fullscreen desktop mode 1920x1080@60Hz
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/data.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/LOC_default.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/loc.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/data2.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/SFX.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/SPEECH_default.pak"
[I] PakReader:574         Loaded PAK "/home/burner/Desktop/ArxLibertatis/build/speech.pak"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/editor"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/game"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/Graph"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/graph"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/localisation"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/misc"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/sfx"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/build/speech"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/data/core/localisation"
[I] PakReader:623         Added dir "/home/burner/Desktop/ArxLibertatis/data/core/misc"
[I] SaveGame:69           Using save game dir "/home/burner/.local/share/arx/save"
[I] SaveGame:174           ├─ "ass"         2025-07-12  17:42
[I] SaveGame:174           ├─ "turds"       2025-07-13   3:23
[I] SaveGame:174           ├─ (quicksave)   2025-07-14  18:37
[I] SaveGame:174           ├─ (quicksave)   2025-07-14  18:10
[I] SaveGame:174           └─ "ratz"        2025-07-12  17:43
[I] OpenALBackend:278     Using OpenAL 1.1 ALSOFT 1.23.1 with EFX 1.0
[I] OpenALBackend:318      ├─ Vendor: OpenAL Community
[I] OpenALBackend:322      ├─ Renderer: OpenAL Soft
[I] OpenALBackend:347      ├─ Device: Scarlett 2i2 4th Gen Analog Stereo
[I] OpenALBackend:350      └─ HRTF: Disabled
[I] Localisation:338      Using text language from config: english
[I] Localisation:355      Using audio language from config: english
[I] Localisation:231      Loading: xtext_default_001_arxlibertatis.ini
[I] Localisation:231      Loading: xtext_english_001_arxlibertatis.ini
[I] ScriptEvent:427       Scripting system initialized with 175 commands and 200 suppressions
[I] FontCache:167         Using FreeType 2.13.2
[I] Text:447              Loaded font "misc/arx.ttf" with sizes 90, 49, 31, 63, 34, 34, 34, 14
[I] ArxGame:798           Initialized Arx Fatalis (full game)
[I] LoadLevel:232         Loading level "graph/levels/level1/level1.dlf"
[I] LoadLevel:509         Done loading level
[I] CinematicLoad:115     Loading cinematic "graph/interface/illustrations/akbaa_dream_c.cin"
[I] ArxGame:1057          Application window is being destroyed
[I] ScriptEvent:433       Scripting system shutdown
[I] ArxGame:937           Clean shutdown

=== Test completed ===
Script finished. Check the full output in: /home/burner/Desktop/ArxLibertatis/fts_test_output.log
